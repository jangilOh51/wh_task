# 프로젝트 설계 문서

## 1. 개요 (Overview)

이 문서는 API 테스트 자동화 프레임워크의 설계와 구조를 설명합니다. 본 프로젝트의 주요 목표는 `pytest`를 기반으로 확장 가능하고 유지보수하기 쉬운 테스트 환경을 구축하는 것입니다. Allure 리포트를 통해 테스트 결과를 효과적으로 시각화하고, 계층화된 아키텍처를 통해 각 컴포넌트의 역할을 명확히 분리합니다.

### 주요 목표
- **모듈성**: 각 API와 테스트 시나리오를 독립적으로 관리하여 재사용성을 높입니다.
- **유지보수성**: API 명세가 변경되더라도 최소한의 코드 수정으로 대응할 수 있는 구조를 지향합니다.
- **가독성**: 서비스 레이어와 데이터 전송 객체(DTO)를 활용하여 테스트 코드의 가독성을 높이고, 시나리오의 흐름을 쉽게 파악할 수 있도록 합니다.
- **시각화**: Allure 리포트를 통해 테스트 실행 결과, 성공/실패 요인, API 요청/응답 등 상세 정보를 시각적으로 제공합니다.

## 2. 시작하기 (Getting Started)

### 2.1. 사전 준비

- **Python**: 버전 3.9 이상
- **Poetry**: Python 의존성 관리 도구
- **Allure Commandline**: 테스트 리포트 생성을 위한 도구

### 2.2. 설치

1.  **프로젝트 클론**:
    ```bash
    git clone [저장소 URL]
    cd [프로젝트 디렉토리]
    ```

2.  **의존성 설치**:
    Poetry를 사용하여 프로젝트에 필요한 모든 라이브러리를 설치합니다.
    ```bash
    poetry install
    ```

### 2.3. 테스트 실행

프로젝트 루트 디렉토리의 `scripts` 폴더에 있는 실행 스크립트를 사용합니다.

- **Windows:**
  ```bash
  scripts\test_run.bat
  ```
- **Linux/macOS:**
  ```bash
  ./scripts/test_run.sh
  ```

테스트 실행이 완료되면 `results/allure-report` 디렉토리에 Allure 리포트가 생성되며, 자동으로 웹 브라우저에서 열립니다.

## 3. 시스템 아키텍처 (System Architecture)

본 프레임워크는 역할과 책임에 따라 명확하게 구분된 계층형 아키텍처를 따릅니다. 이를 통해 코드의 응집도를 높이고 결합도를 낮추어 유연한 구조를 만듭니다.

### 3.1. 아키텍처 다이어그램

```mermaid
graph TD
    A[테스트 케이스 (pytest)] --> B{서비스 레이어};
    B --> C(API 클라이언트);
    C --> D{데이터 모델 (DTO)};
    C --> E[Mock 서버 응답];
    F[테스트 데이터] --> D;
    F --> A;

    subgraph "최상위 계층: 테스트"
        A
    end

    subgraph "중간 계층: 비즈니스 로직"
        B
    end

    subgraph "하위 계층: API 추상화"
        C
        D
    end

    subgraph "인프라 계층"
        E
        F
    end
```

### 3.2. 구성 요소

- **테스트 케이스 (`tests/scenario`)**: 실제 테스트 시나리오를 정의합니다. 비즈니스 요구사항에 가깝게 작성되며, 서비스 레이어를 호출하여 테스트를 수행합니다.
- **서비스 레이어 (`service`)**: 여러 API 호출을 묶어 하나의 의미 있는 비즈니스 로직 또는 사용자 시나리오를 구성합니다.
- **API 클라이언트 (`api`)**: 각 API 엔드포인트와의 직접적인 통신을 담당합니다. 요청 생성, 응답 수신 등의 역할을 합니다.
- **데이터 모델 (`model`)**: API 요청/응답에 사용되는 데이터 객체(DTO)와 테스트 검증(Assertion) 모델을 정의합니다.
- **설정 및 상수 (`config`, `codes`)**: 테스트 환경(URL 등) 설정과 테스트에 사용되는 고정 데이터(ID, 응답 코드 등)를 관리합니다.

## 4. API 테스트 프레임워크 (API Testing Framework)

프레임워크는 테스트의 효율성과 유지보수성을 극대화하기 위해 다음과 같은 설계 원칙을 적용했습니다.

- **DTO (Data Transfer Object) 활용**: API의 요청 및 응답 데이터를 클래스로 정의하여, 코드의 명확성과 안정성을 높입니다. 딕셔너리나 매직 스트링 사용을 지양하고, IDE의 타입 힌팅과 자동 완성 기능을 최대한 활용합니다.

- **서비스 레이어 도입**: 메뉴 선택 후 해당 예약 ID로 주문을 생성하는 것과 같이 여러 단계로 이루어진 복잡한 테스트 시나리오를 단일 서비스 메소드로 캡슐화합니다. 이를 통해 테스트 케이스는 시나리오의 성공/실패 여부에만 집중할 수 있습니다.

- **API 클라이언트 추상화**: 각 API를 별도의 클래스로 분리하여 API 명세 변경 시 영향 범위를 최소화합니다. 모든 API 클라이언트는 공통 `BaseAPI`를 상속받아 일관된 구조를 유지합니다.

- **Mocking 전략**: `pytest-mock`을 사용하여 외부 API 서버에 대한 의존성을 제거했습니다. 이를 통해 네트워크나 외부 서버의 상태와 무관하게 안정적으로 테스트를 실행할 수 있으며, 다양한 예외 상황(예: 재고 부족, 타임아웃)을 손쉽게 시뮬레이션할 수 있습니다.

- **Allure 리포트 연동**: 테스트의 각 단계(`@allure.step`), 기능(`@allure.feature`), 중요도(`@allure.epic`) 등을 데코레이터로 명시하여, 실행 후 생성되는 Allure 리포트에서 체계적이고 상세한 분석이 가능하도록 설계했습니다.

